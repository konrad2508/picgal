#!/usr/bin/env bash
rm -rf out/picgal-linux-x64

rm -rf build
npm run build

cd server

pyinstaller --onefile --name picgal-server src/app.py
rm -rf build picgal-server.spec 

pyinstaller --onefile --name picgal-populate-database src/populate_database.py
rm -rf build picgal-populate-database.spec

pyinstaller --onefile --name picgal-rebuild-previews src/rebuild_previews.py
rm -rf build picgal-rebuild-previews.spec

cd ..

npx electron-packager . picgal --out=out/ --platform=linux --arch=x64 --ignore="(server/src*|server/requirements.txt|node_modules/@.*|node_modules/\.cache|node_modules/\.package-lock\.json|\.gitignore|\.vscode|build-linux-x64|build-win32-x64\.bat|public*|previews*|database\.sqlite|src/components*|src/enums*|src/forms*|src/hooks*|src/services*|src/styles*|src/App\.jsx|src/index\.jsx)"
